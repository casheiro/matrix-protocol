schema: "1.0"
ontology_reference: "moc:squad-payments:v1.0"
version: "2.1.0"

id: uki:squad-payments:business_rule:discount-logic-001
title: "Volume and Coupon Discount Rules"
scope_ref: squad-payments
scope_mode: "restricted"
domain_ref: business
type_ref: business_rule
maturity_ref: validated

created_date: 2024-03-25
last_modified: 2024-03-25
change_summary: "Consolidation of conflicting discount rules and precedence definition"
change_impact: minor
status: active

content: |
  ## Volume Discount Rules
  
  **Automatic application based on total cart value:**
  - $500.00 - $999.99: 5% discount
  - $1,000.00 - $1,999.99: 10% discount  
  - $2,000.00 or more: 15% discount (maximum)
  
  ## Discount Coupons
  
  **Active coupons:**
  - FIRST: 20% first purchase (maximum $100 discount)
  - RETURN: 10% returning customer (no limit)
  - FRIEND: 5% referral (both receive)
  
  ## Application Precedence
  
  **Conflict rule:** Coupons take precedence over automatic volume discount.
  **Exception:** If automatic discount is greater than coupon, apply the higher value.
  **Accumulation:** Coupons do not accumulate. Only one coupon per transaction.
  
  ## Validations
  
  - FIRST coupon: validate if it's the first purchase for the CPF
  - RETURN coupon: validate purchase history (minimum 30 days from last)
  - FRIEND coupon: validate valid referral code
  - Minimum value: $50.00 for any discount

examples:
  - input: "Cart $1,200 + FIRST coupon (new customer)"
    output: "Discount: $100 (FIRST coupon limited), not $120 (10% volume)"
  - input: "Cart $800 + RETURN coupon (returning customer)"  
    output: "Discount: $80 (10% RETURN coupon), not $40 (5% volume)"
  - input: "Cart $2,500 + FRIEND coupon (5%)"
    output: "Discount: $375 (15% volume greater than 5% coupon)"

relationships:
  - type: implements
    target: uki:squad-payments:business_rule:fee-calculation-005
    description: "Fee calculation considers applied discounts"
  
  - type: relates_to
    target: uki:squad-payments:business_rule:refund-policy-002
    description: "Discount affects proportional refund calculation"

domain_of_influence: "engineering_teams"