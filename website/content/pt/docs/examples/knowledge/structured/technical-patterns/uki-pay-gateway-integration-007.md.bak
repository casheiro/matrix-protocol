---
title: "Uki Pay Gateway Integration 007"
description: "P√°gina wrapper para o asset YAML uki-pay-gateway-integration-007.yaml"
layout: "docs"
sidebar: true
toc: true
navigation: true
---

> Source YAML: `pt/docs/examples/knowledge/structured/technical-patterns/uki-pay-gateway-integration-007.yaml`

**Abrir no Visualizador:** [Uki Pay Gateway Integration 007](/pt/docs/viewer?file=/docs/examples/knowledge/structured/technical-patterns/uki-pay-gateway-integration-007.yaml)

> üìÑ Tipo: YAML ‚Ä¢ üì¶ Tamanho: 3.6 KB ‚Ä¢ üïí √öltima modifica√ß√£o: 2025-10-10



```yaml

schema: "1.0"
ontology_reference: "moc:squad-payments:v1.0"
version: "2.0.0"

id: uki:squad-payments:technical_pattern:gateway-integration-007
title: "Padr√£o de Integra√ß√£o com Gateways de Pagamento"
scope_ref: squad-payments
scope_mode: "restricted"
domain_ref: technical
type_ref: pattern
maturity_ref: validated

created_date: 2024-03-25
last_modified: 2024-03-25
change_summary: "Adi√ß√£o de circuit breaker e estrat√©gia de failover baseada em lessons learned"
change_impact: major
status: active

content: |
  ## Arquitetura de Integra√ß√£o
  
  **Interface unificada:** PaymentGatewayInterface
  **Implementa√ß√µes:** StripeGateway, PayPalGateway
  **Padr√£o:** Strategy Pattern para sele√ß√£o din√¢mica
  **Configura√ß√£o:** Environment-based (dev/staging/prod)
  
  ## Circuit Breaker Pattern
  
  **Biblioteca:** Resilience4j
  **Configura√ß√£o por gateway:**
  - Failure threshold: 50% em janela de 10 requests
  - Timeout: 30 segundos (reduzido de 90s)  
  - Half-open: 3 requests de teste
  - Backoff: exponential starting 1s, max 60s
  
  **Estados:**
  - CLOSED: Normal operation
  - OPEN: Gateway indispon√≠vel, requests falham fast
  - HALF_OPEN: Testando recupera√ß√£o
  
  ## Failover Strategy
  
  **Failover autom√°tico:**
  - Stripe principal ‚Üí PayPal backup
  - Trigger: Circuit breaker OPEN por > 2 minutos
  - Fallback: Manual override via admin panel
  
  **Considerations:**
  - PayPal pode rejeitar transa√ß√£o aceita por Stripe
  - Webhooks diferentes por gateway
  - Reconcilia√ß√£o deve considerar fonte
  
  ## Timeout Configuration
  
  **Connection timeout:** 5 segundos
  **Read timeout:** 30 segundos (cr√≠tico para UX)
  **Pool timeout:** 10 segundos  
  **Keep-alive:** 30 segundos
  
  **Retry policy:**
  - Max attempts: 3
  - Backoff: 1s, 2s, 4s
  - Retry on: IOException, SocketTimeoutException
  - No retry: 4xx client errors
  
  ## Error Handling
  
  **Classifica√ß√£o de erros:**
  - **Retriable:** 5xx, timeout, connection issues
  - **Non-retriable:** 4xx client errors, fraud detection
  - **Ambiguous:** 429 rate limit (retry with backoff)
  
  **Error response format:**
  ```json
  {
    "error_code": "GATEWAY_TIMEOUT",
    "message": "Payment gateway temporarily unavailable",
    "retriable": true,
    "gateway": "stripe"
  }
  ```

  
  ## Monitoring and Observability
  
  **M√©tricas obrigat√≥rias:**
  - Latency percentiles (p50, p95, p99)
  - Error rate por gateway
  - Circuit breaker state changes  
  - Failover frequency
  - Request volume per gateway
  
  **Alertas:**
  - Latency p95 > 10s ‚Üí Slack
  - Error rate > 5% ‚Üí PagerDuty
  - Circuit breaker OPEN ‚Üí SMS
  - Failover ativado ‚Üí Email + Slack

examples:
  - input: "Stripe retorna 503, circuit breaker CLOSED, 30% failure rate"
    output: "Retry com backoff, se atingir 50% failures ‚Üí OPEN ‚Üí failover PayPal"
  - input: "Timeout 35s em request Stripe, circuit breaker detecta"
    output: "Request falha, contador errors++, pr√≥ximos requests continuam testando"
  - input: "PayPal rejeita transa√ß√£o R$ 500 que Stripe aceitaria"
    output: "Log discrep√¢ncia, retornar erro espec√≠fico, n√£o retry autom√°tico"

relationships:
  - type: implements
    target: uki:squad-payments:business_rule:fee-calculation-005
    description: "Implementa c√°lculos espec√≠ficos de taxa por gateway"
    
  - type: relates_to
    target: uki:squad-payments:technical_pattern:webhook-handling-009
    description: "Webhooks complementam integra√ß√£o para confirma√ß√£o async"
    
  - type: relates_to
    target: uki:squad-payments:procedure:incident-response-014
    description: "Falhas de gateway seguem processo de incident response"

domain_of_influence: "engineering_teams"
```
