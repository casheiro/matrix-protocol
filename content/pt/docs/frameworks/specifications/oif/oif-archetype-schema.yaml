# OIF Archetype Schema v1.0.0
# Operator Intelligence Framework - Definição de Arquétipos
# Especificação canônica normativa para arquétipos de inteligência artificial

$schema: https://json-schema.org/draft/2020-12/schema
$id: http://localhost:3000/schemas/oif/archetype/1.0.0
version: 1.0.0
title: OIF Archetype Schema
description: Schema canônico para definição de arquétipos OIF no Matrix Protocol
type: object
required:
  - schema
  - archetype_id
  - archetype_name
  - archetype_level
  - version
  - specialization
  - core_capabilities
  - moc_integration
  - metadata
properties:
  schema:
    type: string
    description: Versão do schema OIF Archetype utilizado
    pattern: ^[0-9]+\.[0-9]+$
    examples:
      - "1.0"
      - "1.1"
  archetype_id:
    type: string
    description: Identificador único do arquétipo
    pattern: ^[a-z]+(\.{1}[a-z0-9-]+)?$
    examples:
      - kag
      - wag
      - gad.security
      - gad.prototype
  archetype_name:
    type: string
    description: Nome exibível do arquétipo
    minLength: 5
    maxLength: 100
    examples:
      - Knowledge Agent
      - Workflow Agent
      - Guidance Agent - Security
  archetype_level:
    type: string
    description: Nível do arquétipo no framework OIF
    enum:
      - canonical
      - specialized
      - ephemeral
    examples:
      - canonical
      - specialized
  version:
    type: string
    description: Versão do arquétipo (versionamento semântico)
    pattern: ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)$
    examples:
      - 1.0.0
      - 2.1.3
  specialization:
    type: string
    description: Descrição da especialização do arquétipo
    minLength: 30
    maxLength: 500
    examples:
      - Compreensão, organização e relacionamento de conhecimento MEF
      - Orientação específica de segurança e conformidade de políticas
  domain_ref:
    type: string
    description: Referência ao domínio no MOC (obrigatório para specialized/ephemeral)
    pattern: ^[a-z0-9-]+$|^global$
    examples:
      - global
      - security
      - technical
      - experimental
  scope_ref:
    type: string
    description: Referência ao escopo no MOC (obrigatório para specialized/ephemeral)
    pattern: ^[a-z0-9-]+$|^all$
    examples:
      - all
      - organization
      - tribe
      - sandbox
  core_capabilities:
    type: object
    description: Capacidades centrais do arquétipo
    required:
      - primary_functions
      - input_types
      - output_types
    properties:
      primary_functions:
        type: array
        description: Funções primárias do arquétipo
        minItems: 1
        items:
          type: object
          required:
            - function_name
            - description
            - moc_aware
          properties:
            function_name:
              type: string
              description: Nome da função
              examples:
                - semantic_search
                - workflow_orchestration
                - security_guidance
            description:
              type: string
              description: Descrição detalhada da função
              minLength: 30
              examples:
                - Busca inteligente em UKIs com filtragem MOC
            moc_aware:
              type: boolean
              description: Função é consciente das hierarquias MOC
              examples:
                - true
                - false
            input_requirements:
              type: array
              description: Requisitos de entrada da função
              items:
                type: string
              examples:
                - - user_context
                  - query_parameters
            output_format:
              type: string
              description: Formato de saída da função
              examples:
                - filtered_ukis
                - workflow_state
                - security_recommendation
          additionalProperties: false
      input_types:
        type: array
        description: Tipos de entrada que o arquétipo processa
        minItems: 1
        items:
          type: string
          enum:
            - natural_language_query
            - structured_query
            - uki_reference
            - workflow_context
            - user_context
            - moc_context
            - arbitration_result
            - conflict_event
            - system_state
        examples:
          - - natural_language_query
            - user_context
      output_types:
        type: array
        description: Tipos de saída que o arquétipo produz
        minItems: 1
        items:
          type: string
          enum:
            - filtered_knowledge
            - workflow_instruction
            - explanation
            - recommendation
            - decision_rationale
            - escalation_path
            - system_action
            - user_notification
        examples:
          - - filtered_knowledge
            - explanation
      performance_characteristics:
        type: object
        description: Características de performance esperadas
        properties:
          response_time_target_ms:
            type: integer
            description: Tempo de resposta alvo em milissegundos
            minimum: 100
            maximum: 30000
            examples:
              - 1000
              - 5000
          throughput_target:
            type: integer
            description: Requisições por minuto alvo
            minimum: 1
            examples:
              - 60
              - 300
          accuracy_target:
            type: number
            description: Taxa de acurácia alvo (0.0 a 1.0)
            minimum: 0.5
            maximum: 1
            examples:
              - 0.85
              - 0.95
          explainability_score:
            type: number
            description: Pontuação de explicabilidade (0.0 a 1.0)
            minimum: 0.7
            maximum: 1
            examples:
              - 0.9
              - 0.95
        additionalProperties: false
    additionalProperties: false
  moc_integration:
    type: object
    description: Configuração de integração com MOC organizacional
    required:
      - authority_validation
      - hierarchical_filtering
      - governance_explanation
    properties:
      authority_validation:
        type: object
        description: Configuração de validação de autoridade
        required:
          - enabled
          - validation_method
          - escalation_handling
        properties:
          enabled:
            type: boolean
            description: Validação de autoridade habilitada
            const: true
          validation_method:
            type: string
            description: Método de validação utilizado
            enum:
              - moc_based
              - role_based
              - hybrid
            examples:
              - moc_based
          escalation_handling:
            type: boolean
            description: Tratamento automático de escalação
            default: true
          cache_duration_ms:
            type: integer
            description: Duração do cache de validação
            minimum: 1000
            maximum: 3600000
            default: 300000
        additionalProperties: false
      hierarchical_filtering:
        type: object
        description: Configuração de filtragem hierárquica
        required:
          - scope_filtering
          - domain_filtering
          - contextual_access
        properties:
          scope_filtering:
            type: object
            description: Filtragem baseada em escopo
            required:
              - enabled
              - filter_mode
            properties:
              enabled:
                type: boolean
                description: Filtragem de escopo habilitada
                const: true
              filter_mode:
                type: string
                description: Modo de filtragem de escopo
                enum:
                  - inclusive
                  - exclusive
                  - hierarchical
                default: hierarchical
              inheritance_rules:
                type: boolean
                description: Aplicar regras de herança hierárquica
                default: true
            additionalProperties: false
          domain_filtering:
            type: object
            description: Filtragem baseada em domínio
            required:
              - enabled
              - access_control
            properties:
              enabled:
                type: boolean
                description: Filtragem de domínio habilitada
                const: true
              access_control:
                type: string
                description: Tipo de controle de acesso
                enum:
                  - whitelist
                  - blacklist
                  - role_based
                default: role_based
              cross_domain_access:
                type: boolean
                description: Permitir acesso cross-domain
                default: false
            additionalProperties: false
          contextual_access:
            type: object
            description: Acesso baseado em contexto
            properties:
              user_context_required:
                type: boolean
                description: Contexto de usuário obrigatório
                default: true
              session_awareness:
                type: boolean
                description: Consciência de sessão do usuário
                default: true
              temporal_constraints:
                type: boolean
                description: Aplicar restrições temporais
                default: false
            additionalProperties: false
        additionalProperties: false
      governance_explanation:
        type: object
        description: Configuração de explicação de governança
        required:
          - moc_node_citation
          - explanation_depth
          - transparency_level
        properties:
          moc_node_citation:
            type: boolean
            description: Citar nós MOC específicos nas explicações
            const: true
          explanation_depth:
            type: string
            description: Profundidade das explicações
            enum:
              - minimal
              - standard
              - detailed
              - comprehensive
            default: standard
          transparency_level:
            type: string
            description: Nível de transparência das decisões
            enum:
              - basic
              - intermediate
              - full
            default: intermediate
          include_escalation_paths:
            type: boolean
            description: Incluir caminhos de escalação nas explicações
            default: true
        additionalProperties: false
    additionalProperties: false
  level_specific_config:
    type: object
    description: Configurações específicas do nível do arquétipo
    oneOf:
      - if:
          properties:
            archetype_level:
              const: canonical
        then:
          properties:
            canonical_config:
              type: object
              required:
                - prompt_protection
                - behavioral_constraints
              properties:
                prompt_protection:
                  type: object
                  description: Proteção de prompts canônicos
                  required:
                    - immutable_prompts
                    - override_allowed
                  properties:
                    immutable_prompts:
                      type: boolean
                      description: Prompts são imutáveis
                      const: true
                    override_allowed:
                      type: boolean
                      description: Override permitido
                      const: false
                    modification_restrictions:
                      type: array
                      description: Restrições de modificação
                      items:
                        type: string
                      examples:
                        - - core_system_prompt
                          - knowledge_access_patterns
                behavioral_constraints:
                  type: object
                  description: Restrições comportamentais
                  properties:
                    domain_agnostic:
                      type: boolean
                      description: Deve permanecer agnóstico a domínio
                      default: true
                    organization_neutral:
                      type: boolean
                      description: Deve ser neutro organizacionalmente
                      default: true
      - if:
          properties:
            archetype_level:
              const: specialized
        then:
          properties:
            specialized_config:
              type: object
              required:
                - moc_validation_required
                - extension_patterns
              properties:
                moc_validation_required:
                  type: boolean
                  description: Validação MOC obrigatória
                  const: true
                extension_patterns:
                  type: object
                  description: Padrões de extensão permitidos
                  properties:
                    domain_specialization:
                      type: boolean
                      description: Especialização de domínio permitida
                      default: true
                    organizational_context:
                      type: boolean
                      description: Contexto organizacional permitido
                      default: true
                    workflow_integration:
                      type: boolean
                      description: Integração de workflow específico
                      default: true
                base_archetype_inheritance:
                  type: string
                  description: Arquétipo base herdado
                  enum:
                    - kag
                    - wag
                  examples:
                    - kag
                    - wag
      - if:
          properties:
            archetype_level:
              const: ephemeral
        then:
          properties:
            ephemeral_config:
              type: object
              required:
                - session_lifetime
                - persistence_allowed
              properties:
                session_lifetime:
                  type: boolean
                  description: Limitado ao tempo de sessão
                  const: true
                persistence_allowed:
                  type: boolean
                  description: Persistência permitida
                  const: false
                experimental_features:
                  type: boolean
                  description: Recursos experimentais habilitados
                  default: true
                sandbox_restrictions:
                  type: object
                  description: Restrições de sandbox
                  properties:
                    moc_bypass_allowed:
                      type: boolean
                      description: Bypass do MOC permitido
                      default: true
                    production_access:
                      type: boolean
                      description: Acesso à produção
                      default: false
  quality_metrics:
    type: object
    description: Métricas de qualidade obrigatórias
    required:
      - explainability_metrics
      - hierarchical_filtering_metrics
      - derived_authority_metrics
    properties:
      explainability_metrics:
        type: object
        description: Métricas de explicabilidade
        required:
          - clarity_target
          - traceability_target
        properties:
          clarity_target:
            type: number
            description: Meta de clareza (porcentagem)
            minimum: 0.8
            maximum: 1
            default: 0.85
          traceability_target:
            type: number
            description: Meta de rastreabilidade (porcentagem)
            minimum: 0.95
            maximum: 1
            default: 1
          measurement_frequency:
            type: string
            description: Frequência de medição
            enum:
              - real_time
              - hourly
              - daily
              - weekly
            default: real_time
        additionalProperties: false
      hierarchical_filtering_metrics:
        type: object
        description: Métricas de filtragem hierárquica
        required:
          - precision_target
          - authority_compliance_target
        properties:
          precision_target:
            type: number
            description: Meta de precisão na filtragem
            minimum: 0.9
            maximum: 1
            default: 0.95
          authority_compliance_target:
            type: number
            description: Meta de conformidade com autoridade
            minimum: 0.98
            maximum: 1
            default: 1
        additionalProperties: false
      derived_authority_metrics:
        type: object
        description: Métricas de autoridade derivada
        required:
          - contextualization_target
          - humility_integration_target
        properties:
          contextualization_target:
            type: number
            description: Meta de contextualização vs respostas absolutas
            minimum: 0.85
            maximum: 1
            default: 0.9
          humility_integration_target:
            type: number
            description: Meta de integração de humildade epistêmica
            minimum: 0.75
            maximum: 1
            default: 0.8
          absolute_truth_avoidance_target:
            type: number
            description: Meta de evitação de verdades absolutas
            minimum: 0.95
            maximum: 1
            default: 1
        additionalProperties: false
    additionalProperties: false
  mal_integration:
    type: object
    description: Configuração de integração com MAL (quando aplicável)
    properties:
      arbitration_explanation:
        type: boolean
        description: Capacidade de explicar arbitragens MAL
        default: false
      explanation_template_support:
        type: boolean
        description: Suporte a templates de explicação de arbitragem
        default: false
      decision_record_interpretation:
        type: boolean
        description: Capacidade de interpretar Decision Records
        default: false
      user_communication_role:
        type: string
        description: Papel na comunicação de resultados MAL
        enum:
          - none
          - interpreter
          - communicator
          - full_handler
        default: none
    additionalProperties: false
  metadata:
    type: object
    description: Metadados do arquétipo
    required:
      - created_date
      - last_modified
      - maintainer
      - validation_status
    properties:
      created_date:
        type: string
        format: date
        description: Data de criação do arquétipo
      last_modified:
        type: string
        format: date
        description: Data da última modificação
      maintainer:
        type: string
        description: Responsável pela manutenção do arquétipo
        examples:
          - protocol-team
          - platform-team
          - security-team
      validation_status:
        type: string
        description: Status de validação do arquétipo
        enum:
          - valid
          - pending
          - invalid
          - experimental
        examples:
          - valid
          - experimental
      change_summary:
        type: string
        description: Resumo das mudanças na versão atual
      deployment_environments:
        type: array
        description: Ambientes onde o arquétipo pode ser implantado
        items:
          type: string
          enum:
            - development
            - staging
            - production
            - sandbox
        examples:
          - - development
            - production
      compatibility_matrix:
        type: object
        description: Matriz de compatibilidade com outros frameworks
        properties:
          mef_version:
            type: string
            description: Versão compatível do MEF
          moc_version:
            type: string
            description: Versão compatível do MOC
          zof_version:
            type: string
            description: Versão compatível do ZOF
          mal_version:
            type: string
            description: Versão compatível do MAL
        additionalProperties: false
    additionalProperties: false
additionalProperties: false
allOf:
  - if:
      properties:
        archetype_level:
          const: canonical
    then:
      properties:
        domain_ref:
          const: global
        scope_ref:
          const: all
      required:
        - domain_ref
        - scope_ref
  - if:
      properties:
        archetype_level:
          enum:
            - specialized
            - ephemeral
    then:
      properties:
        domain_ref:
          not:
            const: global
        scope_ref:
          not:
            const: all
      required:
        - domain_ref
        - scope_ref
  - if:
      properties:
        mal_integration:
          properties:
            arbitration_explanation:
              const: true
    then:
      properties:
        mal_integration:
          required:
            - explanation_template_support
            - decision_record_interpretation
