# MOC Arbitration Policies Schema v1.0.0
# Matrix Ontology Catalog - Políticas de Arbitragem para integração MAL
# Especificação canônica normativa para configuração de políticas de arbitragem

$schema: https://json-schema.org/draft/2020-12/schema
$id: http://localhost:3000/schemas/moc/arbitration-policies/1.0.0
version: 1.0.0
title: MOC Arbitration Policies Schema
description: Schema canônico para políticas de arbitragem MAL no MOC
type: object
required:
  - schema
  - organization_id
  - version
  - arbitration_policies
  - metadata
properties:
  schema:
    type: string
    description: Versão do schema MOC Arbitration Policies utilizado
    pattern: ^[0-9]+\.[0-9]+$
    examples:
      - "1.0"
      - "1.1"
  organization_id:
    type: string
    description: Identificador único da organização
    pattern: ^[a-z0-9-]+$
    examples:
      - techcorp
      - startup-alpha
  version:
    type: string
    description: Versão da configuração de políticas de arbitragem
    pattern: ^(0|[1-9]\d*)\.(0|[1-9]\d*)$
    examples:
      - "1.0"
      - "2.1"
  arbitration_policies:
    type: object
    description: Configurações de políticas para arbitragem MAL
    required:
      - default_precedence_order
      - arbitration_timeout
      - conflict_type_policies
    properties:
      default_precedence_order:
        type: array
        description: Ordem padrão de regras de precedência P1-P6
        minItems: 6
        maxItems: 10
        items:
          type: string
          pattern: ^P[0-9]+_[a-z_]+$
        examples:
          - - P1_authority_weight
            - P2_scope_specificity
            - P3_maturity_level
            - P4_temporal_recency
            - P5_evidence_density
            - P6_deterministic_fallback
      arbitration_timeout:
        type: integer
        description: Timeout para decisão MAL em milissegundos
        minimum: 1000
        maximum: 600000
        default: 2000
        examples:
          - 2000
          - 5000
          - 10000
      scope_specificity_rules:
        type: object
        description: Configuração da regra P2 de especificidade de escopo
        required:
          - local_instructions
          - mandatory_rules
        properties:
          local_instructions:
            type: object
            description: Precedência para orientações locais
            required:
              - precedence_order
            properties:
              precedence_order:
                type: array
                description: Ordem de precedência por especificidade (mais específico primeiro)
                items:
                  type: string
                  pattern: ^[a-z0-9-]+$
                examples:
                  - - squad
                    - tribe
                    - organization
              applies_to_types:
                type: array
                description: Tipos de conhecimento que seguem esta regra
                items:
                  type: string
                examples:
                  - - guideline
                    - pattern
                    - best_practice
            additionalProperties: false
          mandatory_rules:
            type: object
            description: Precedência para regras obrigatórias
            required:
              - precedence_order
            properties:
              precedence_order:
                type: array
                description: Ordem de precedência por autoridade (mais alto primeiro)
                items:
                  type: string
                  pattern: ^[a-z0-9-]+$
                examples:
                  - - organization
                    - tribe
                    - squad
              applies_to_types:
                type: array
                description: Tipos de conhecimento que seguem esta regra
                items:
                  type: string
                examples:
                  - - policy
                    - compliance
                    - security_rule
            additionalProperties: false
        additionalProperties: false
      conflict_type_policies:
        type: object
        description: Políticas específicas por tipo de conflito H1/H2/H3
        required:
          - H1_horizontal_conflicts
          - H2_concurrent_enrichment
          - H3_promotion_contention
        properties:
          H1_horizontal_conflicts:
            type: object
            description: Políticas para conflitos horizontais entre UKIs equivalentes
            required:
              - enable_coexistence
              - require_deprecation
            properties:
              enable_coexistence:
                type: boolean
                description: Permitir particionamento de escopo para coexistência
                default: true
                examples:
                  - true
                  - false
              require_deprecation:
                type: boolean
                description: Forçar winner-take-all com depreciação do perdedor
                default: false
                examples:
                  - false
                  - true
              coexistence_strategy:
                type: string
                description: Estratégia de coexistência quando habilitada
                enum:
                  - scope_partition
                  - domain_partition
                  - temporal_partition
                default: scope_partition
                examples:
                  - scope_partition
              precedence_order:
                type: array
                description: Ordem de precedência específica para H1
                items:
                  type: string
                  pattern: ^P[0-9]+_[a-z_]+$
                examples:
                  - - P1_authority_weight
                    - P3_maturity_level
                    - P2_scope_specificity
              evidence_weight_multiplier:
                type: number
                description: Multiplicador de peso para evidência em conflitos H1
                minimum: 0.1
                maximum: 5
                default: 1
                examples:
                  - 1
                  - 1.5
                  - 2
            additionalProperties: false
          H2_concurrent_enrichment:
            type: object
            description: Políticas para tentativas de enriquecimento concorrente
            required:
              - temporal_window_ms
              - precedence_order
            properties:
              temporal_window_ms:
                type: integer
                description: Janela temporal para considerar enriquecimento concorrente
                minimum: 1000
                maximum: 300000
                default: 30000
                examples:
                  - 30000
                  - 60000
              precedence_order:
                type: array
                description: Ordem de precedência específica para H2
                items:
                  type: string
                  pattern: ^P[0-9]+_[a-z_]+$
                examples:
                  - - P4_temporal_recency
                    - P1_authority_weight
                    - P3_maturity_level
              first_wins_policy:
                type: boolean
                description: Primeira solicitação sempre vence em caso de empate
                default: false
                examples:
                  - false
                  - true
              authority_escalation:
                type: boolean
                description: Escalar para autoridade superior em caso de empate
                default: true
                examples:
                  - true
                  - false
            additionalProperties: false
          H3_promotion_contention:
            type: object
            description: Políticas para propostas concorrentes de promoção
            required:
              - evidence_density_multiplier
              - precedence_order
            properties:
              evidence_density_multiplier:
                type: number
                description: Peso extra para densidade de evidência em promoções
                minimum: 1
                maximum: 10
                default: 1.5
                examples:
                  - 1.5
                  - 2
                  - 3
              precedence_order:
                type: array
                description: Ordem de precedência específica para H3
                items:
                  type: string
                  pattern: ^P[0-9]+_[a-z_]+$
                examples:
                  - - P5_evidence_density
                    - P1_authority_weight
                    - P3_maturity_level
              require_promotion_rationale:
                type: boolean
                description: Requer justificativa obrigatória para promoção
                default: true
                examples:
                  - true
                  - false
              minimum_evidence_threshold:
                type: integer
                description: Número mínimo de evidências para promoção
                minimum: 0
                maximum: 10
                default: 2
                examples:
                  - 2
                  - 3
                  - 5
            additionalProperties: false
        additionalProperties: false
      named_policies:
        type: object
        description: Políticas de arbitragem nomeadas para contextos específicos
        patternProperties:
          ^[a-z0-9_-]+$:
            type: object
            required:
              - display_name
              - description
              - applicable_contexts
            properties:
              display_name:
                type: string
                description: Nome exibível da política
                examples:
                  - Política de Segurança
                  - Política Experimental
              description:
                type: string
                description: Descrição da política e quando usar
                minLength: 50
                examples:
                  - Política específica para conhecimento de segurança crítica
              precedence_order:
                type: array
                description: Ordem de precedência customizada
                items:
                  type: string
                  pattern: ^P[0-9]+_[a-z_]+$
                examples:
                  - - P1_authority_weight
                    - P3_maturity_level
                    - P2_scope_specificity
              custom_rules:
                type: array
                description: Regras de precedência customizadas adicionais
                items:
                  type: object
                  required:
                    - rule_id
                    - description
                    - weight
                  properties:
                    rule_id:
                      type: string
                      pattern: ^P[0-9]+_[a-z_]+$
                      examples:
                        - P7_lifecycle_stage
                        - P8_compliance_level
                    description:
                      type: string
                      examples:
                        - Ciclo de vida tem precedência
                        - Nível de conformidade
                    weight:
                      type: number
                      minimum: 0
                      maximum: 1
                  additionalProperties: false
              applicable_contexts:
                type: object
                description: Contextos onde esta política se aplica
                properties:
                  scopes:
                    type: array
                    items:
                      type: string
                      pattern: ^[a-z0-9-]+$
                  domains:
                    type: array
                    items:
                      type: string
                      pattern: ^[a-z0-9-]+$
                  knowledge_types:
                    type: array
                    items:
                      type: string
                      pattern: ^[a-z0-9_]+$
                  maturity_levels:
                    type: array
                    items:
                      type: string
                      pattern: ^[a-z0-9_]+$
                additionalProperties: false
              overrides:
                type: object
                description: Configurações que sobrescrevem padrões
                properties:
                  arbitration_timeout:
                    type: integer
                    minimum: 1000
                    maximum: 600000
                  conflict_type_configs:
                    type: object
                    properties:
                      H1:
                        type: object
                        additionalProperties: true
                      H2:
                        type: object
                        additionalProperties: true
                      H3:
                        type: object
                        additionalProperties: true
                    additionalProperties: false
                additionalProperties: false
            additionalProperties: false
        additionalProperties: false
    additionalProperties: false
  policy_reference_structure:
    type: object
    description: Estrutura de namespace para referência de políticas
    required:
      - namespace_format
    properties:
      namespace_format:
        type: string
        description: Formato de namespace para políticas
        default: moc:arbitration:{policy_name}
        examples:
          - moc:arbitration:{policy_name}
      reserved_names:
        type: array
        description: Nomes de política reservados
        items:
          type: string
        examples:
          - - default
            - critical
            - experimental
      policy_inheritance:
        type: object
        description: Configuração de herança de políticas
        properties:
          default_fallback:
            type: string
            description: Política de fallback padrão
            default: default_precedence_order
          policy_override:
            type: string
            description: Política nomeada substitui completamente o padrão
            const: política nomeada substitui completamente o padrão
          policy_extension:
            type: string
            description: Política nomeada modifica regras específicas
            const: política nomeada modifica regras específicas de precedência
        additionalProperties: false
    additionalProperties: false
  metadata:
    type: object
    description: Metadados da configuração de políticas
    required:
      - created_date
      - last_modified
      - maintainer
    properties:
      created_date:
        type: string
        format: date
        description: Data de criação da configuração
      last_modified:
        type: string
        format: date
        description: Data da última modificação
      maintainer:
        type: string
        description: Responsável pela manutenção das políticas
        examples:
          - governance-team
          - security-team
      change_summary:
        type: string
        description: Resumo das mudanças na versão atual
      validation_status:
        type: string
        description: Status de validação da configuração
        enum:
          - valid
          - pending
          - invalid
      approval_authority:
        type: string
        description: Autoridade que aprovou as políticas
        examples:
          - cto
          - governance-board
      approval_date:
        type: string
        format: date
        description: Data de aprovação das políticas
      testing_results:
        type: object
        description: Resultados de testes das políticas
        properties:
          last_test_date:
            type: string
            format: date
          test_scenarios:
            type: integer
            description: Número de cenários testados
            minimum: 0
          success_rate:
            type: number
            description: Taxa de sucesso dos testes
            minimum: 0
            maximum: 1
        additionalProperties: false
    additionalProperties: false
additionalProperties: false
allOf:
  - properties:
      arbitration_policies:
        properties:
          default_precedence_order:
            contains:
              const: P1_authority_weight
  - properties:
      arbitration_policies:
        properties:
          default_precedence_order:
            contains:
              const: P6_deterministic_fallback
  - properties:
      arbitration_policies:
        properties:
          default_precedence_order:
            additionalItems: false
            items:
              - true
              - true
              - true
              - true
              - true
              - const: P6_deterministic_fallback
