# OIF Archetype Schema v1.0.0
# Operator Intelligence Framework - Archetype Definition
# Normative canonical specification for artificial intelligence archetypes

$schema: https://json-schema.org/draft/2020-12/schema
$id: http://localhost:3000/schemas/oif/archetype/1.0.0
version: 1.0.0
title: OIF Archetype Schema
description: Canonical schema for OIF archetype definition in Matrix Protocol
type: object
required:
  - schema
  - archetype_id
  - archetype_name
  - archetype_level
  - version
  - specialization
  - core_capabilities
  - moc_integration
  - metadata
properties:
  schema:
    type: string
    description: Schema version OIF Archetype used
    pattern: ^[0-9]+\.[0-9]+$
    examples:
      - "1.0"
      - "1.1"
  archetype_id:
    type: string
    description: Unique identifier for the archetype
    pattern: ^[a-z]+(\.{1}[a-z0-9-]+)?$
    examples:
      - kag
      - wag
      - gad.security
      - gad.prototype
  archetype_name:
    type: string
    description: Display name for the archetype
    minLength: 5
    maxLength: 100
    examples:
      - Knowledge Agent
      - Workflow Agent
      - Guidance Agent - Security
  archetype_level:
    type: string
    description: Archetype level in the OIF framework
    enum:
      - canonical
      - specialized
      - ephemeral
    examples:
      - canonical
      - specialized
  version:
    type: string
    description: Archetype version (semantic versioning)
    pattern: ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)$
    examples:
      - 1.0.0
      - 2.1.3
  specialization:
    type: string
    description: Description of the archetype specialization
    minLength: 30
    maxLength: 500
    examples:
      - Understanding, organization and relationship of MEF knowledge
      - Specific guidance for security and policy compliance
  domain_ref:
    type: string
    description: Reference to domain in MOC (required for specialized/ephemeral)
    pattern: ^[a-z0-9-]+$|^global$
    examples:
      - global
      - security
      - technical
      - experimental
  scope_ref:
    type: string
    description: Reference to scope in MOC (required for specialized/ephemeral)
    pattern: ^[a-z0-9-]+$|^all$
    examples:
      - all
      - organization
      - tribe
      - sandbox
  core_capabilities:
    type: object
    description: Core capabilities of the archetype
    required:
      - primary_functions
      - input_types
      - output_types
    properties:
      primary_functions:
        type: array
        description: Primary functions of the archetype
        minItems: 1
        items:
          type: object
          required:
            - function_name
            - description
            - moc_aware
          properties:
            function_name:
              type: string
              description: Function name
              examples:
                - semantic_search
                - workflow_orchestration
                - security_guidance
            description:
              type: string
              description: Detailed description of the function
              minLength: 30
              examples:
                - Intelligent search in UKIs with MOC filtering
            moc_aware:
              type: boolean
              description: Function is aware of MOC hierarchies
              examples:
                - true
                - false
            input_requirements:
              type: array
              description: Function input requirements
              items:
                type: string
              examples:
                - - user_context
                  - query_parameters
            output_format:
              type: string
              description: Function output format
              examples:
                - filtered_ukis
                - workflow_state
                - security_recommendation
          additionalProperties: false
      input_types:
        type: array
        description: Input types that the archetype processes
        minItems: 1
        items:
          type: string
          enum:
            - natural_language_query
            - structured_query
            - uki_reference
            - workflow_context
            - user_context
            - moc_context
            - arbitration_result
            - conflict_event
            - system_state
        examples:
          - - natural_language_query
            - user_context
      output_types:
        type: array
        description: Output types that the archetype produces
        minItems: 1
        items:
          type: string
          enum:
            - filtered_knowledge
            - workflow_instruction
            - explanation
            - recommendation
            - decision_rationale
            - escalation_path
            - system_action
            - user_notification
        examples:
          - - filtered_knowledge
            - explanation
      performance_characteristics:
        type: object
        description: Expected performance characteristics
        properties:
          response_time_target_ms:
            type: integer
            description: Target response time in milliseconds
            minimum: 100
            maximum: 30000
            examples:
              - 1000
              - 5000
          throughput_target:
            type: integer
            description: Target requests per minute
            minimum: 1
            examples:
              - 60
              - 300
          accuracy_target:
            type: number
            description: Target accuracy rate (0.0 to 1.0)
            minimum: 0.5
            maximum: 1
            examples:
              - 0.85
              - 0.95
          explainability_score:
            type: number
            description: Explainability score (0.0 to 1.0)
            minimum: 0.7
            maximum: 1
            examples:
              - 0.9
              - 0.95
        additionalProperties: false
    additionalProperties: false
  moc_integration:
    type: object
    description: Organizational MOC integration configuration
    required:
      - authority_validation
      - hierarchical_filtering
      - governance_explanation
    properties:
      authority_validation:
        type: object
        description: Authority validation configuration
        required:
          - enabled
          - validation_method
          - escalation_handling
        properties:
          enabled:
            type: boolean
            description: Authority validation enabled
            const: true
          validation_method:
            type: string
            description: Validation method used
            enum:
              - moc_based
              - role_based
              - hybrid
            examples:
              - moc_based
          escalation_handling:
            type: boolean
            description: Automatic escalation handling
            default: true
          cache_duration_ms:
            type: integer
            description: Validation cache duration
            minimum: 1000
            maximum: 3600000
            default: 300000
        additionalProperties: false
      hierarchical_filtering:
        type: object
        description: Hierarchical filtering configuration
        required:
          - scope_filtering
          - domain_filtering
          - contextual_access
        properties:
          scope_filtering:
            type: object
            description: Scope-based filtering
            required:
              - enabled
              - filter_mode
            properties:
              enabled:
                type: boolean
                description: Scope filtering enabled
                const: true
              filter_mode:
                type: string
                description: Scope filtering mode
                enum:
                  - inclusive
                  - exclusive
                  - hierarchical
                default: hierarchical
              inheritance_rules:
                type: boolean
                description: Apply hierarchical inheritance rules
                default: true
            additionalProperties: false
          domain_filtering:
            type: object
            description: Domain-based filtering
            required:
              - enabled
              - access_control
            properties:
              enabled:
                type: boolean
                description: Domain filtering enabled
                const: true
              access_control:
                type: string
                description: Access control type
                enum:
                  - whitelist
                  - blacklist
                  - role_based
                default: role_based
              cross_domain_access:
                type: boolean
                description: Allow cross-domain access
                default: false
            additionalProperties: false
          contextual_access:
            type: object
            description: Context-based access
            properties:
              user_context_required:
                type: boolean
                description: User context required
                default: true
              session_awareness:
                type: boolean
                description: User session awareness
                default: true
              temporal_constraints:
                type: boolean
                description: Apply temporal constraints
                default: false
            additionalProperties: false
        additionalProperties: false
      governance_explanation:
        type: object
        description: Governance explanation configuration
        required:
          - moc_node_citation
          - explanation_depth
          - transparency_level
        properties:
          moc_node_citation:
            type: boolean
            description: Cite specific MOC nodes in explanations
            const: true
          explanation_depth:
            type: string
            description: Explanation depth
            enum:
              - minimal
              - standard
              - detailed
              - comprehensive
            default: standard
          transparency_level:
            type: string
            description: Decision transparency level
            enum:
              - basic
              - intermediate
              - full
            default: intermediate
          include_escalation_paths:
            type: boolean
            description: Include escalation paths in explanations
            default: true
        additionalProperties: false
    additionalProperties: false
  level_specific_config:
    type: object
    description: Archetype level-specific configurations
    oneOf:
      - if:
          properties:
            archetype_level:
              const: canonical
        then:
          properties:
            canonical_config:
              type: object
              required:
                - prompt_protection
                - behavioral_constraints
              properties:
                prompt_protection:
                  type: object
                  description: Canonical prompt protection
                  required:
                    - immutable_prompts
                    - override_allowed
                  properties:
                    immutable_prompts:
                      type: boolean
                      description: Prompts are immutable
                      const: true
                    override_allowed:
                      type: boolean
                      description: Override allowed
                      const: false
                    modification_restrictions:
                      type: array
                      description: Modification restrictions
                      items:
                        type: string
                      examples:
                        - - core_system_prompt
                          - knowledge_access_patterns
                behavioral_constraints:
                  type: object
                  description: Behavioral constraints
                  properties:
                    domain_agnostic:
                      type: boolean
                      description: Must remain domain-agnostic
                      default: true
                    organization_neutral:
                      type: boolean
                      description: Must be organizationally neutral
                      default: true
      - if:
          properties:
            archetype_level:
              const: specialized
        then:
          properties:
            specialized_config:
              type: object
              required:
                - moc_validation_required
                - extension_patterns
              properties:
                moc_validation_required:
                  type: boolean
                  description: MOC validation required
                  const: true
                extension_patterns:
                  type: object
                  description: Allowed extension patterns
                  properties:
                    domain_specialization:
                      type: boolean
                      description: Domain specialization allowed
                      default: true
                    organizational_context:
                      type: boolean
                      description: Organizational context allowed
                      default: true
                    workflow_integration:
                      type: boolean
                      description: Specific workflow integration
                      default: true
                base_archetype_inheritance:
                  type: string
                  description: Inherited base archetype
                  enum:
                    - kag
                    - wag
                  examples:
                    - kag
                    - wag
      - if:
          properties:
            archetype_level:
              const: ephemeral
        then:
          properties:
            ephemeral_config:
              type: object
              required:
                - session_lifetime
                - persistence_allowed
              properties:
                session_lifetime:
                  type: boolean
                  description: Limited to session lifetime
                  const: true
                persistence_allowed:
                  type: boolean
                  description: Persistence allowed
                  const: false
                experimental_features:
                  type: boolean
                  description: Experimental features enabled
                  default: true
                sandbox_restrictions:
                  type: object
                  description: Sandbox restrictions
                  properties:
                    moc_bypass_allowed:
                      type: boolean
                      description: MOC bypass allowed
                      default: true
                    production_access:
                      type: boolean
                      description: Production access
                      default: false
  quality_metrics:
    type: object
    description: Mandatory quality metrics
    required:
      - explainability_metrics
      - hierarchical_filtering_metrics
      - derived_authority_metrics
    properties:
      explainability_metrics:
        type: object
        description: Explainability metrics
        required:
          - clarity_target
          - traceability_target
        properties:
          clarity_target:
            type: number
            description: Clarity target (percentage)
            minimum: 0.8
            maximum: 1
            default: 0.85
          traceability_target:
            type: number
            description: Traceability target (percentage)
            minimum: 0.95
            maximum: 1
            default: 1
          measurement_frequency:
            type: string
            description: Measurement frequency
            enum:
              - real_time
              - hourly
              - daily
              - weekly
            default: real_time
        additionalProperties: false
      hierarchical_filtering_metrics:
        type: object
        description: Hierarchical filtering metrics
        required:
          - precision_target
          - authority_compliance_target
        properties:
          precision_target:
            type: number
            description: Filtering precision target
            minimum: 0.9
            maximum: 1
            default: 0.95
          authority_compliance_target:
            type: number
            description: Authority compliance target
            minimum: 0.98
            maximum: 1
            default: 1
        additionalProperties: false
      derived_authority_metrics:
        type: object
        description: Derived authority metrics
        required:
          - contextualization_target
          - humility_integration_target
        properties:
          contextualization_target:
            type: number
            description: Contextualization vs absolute responses target
            minimum: 0.85
            maximum: 1
            default: 0.9
          humility_integration_target:
            type: number
            description: Epistemic humility integration target
            minimum: 0.75
            maximum: 1
            default: 0.8
          absolute_truth_avoidance_target:
            type: number
            description: Absolute truth avoidance target
            minimum: 0.95
            maximum: 1
            default: 1
        additionalProperties: false
    additionalProperties: false
  mal_integration:
    type: object
    description: MAL integration configuration (when applicable)
    properties:
      arbitration_explanation:
        type: boolean
        description: Ability to explain MAL arbitrations
        default: false
      explanation_template_support:
        type: boolean
        description: Support for arbitration explanation templates
        default: false
      decision_record_interpretation:
        type: boolean
        description: Ability to interpret Decision Records
        default: false
      user_communication_role:
        type: string
        description: Role in MAL results communication
        enum:
          - none
          - interpreter
          - communicator
          - full_handler
        default: none
    additionalProperties: false
  metadata:
    type: object
    description: Archetype metadata
    required:
      - created_date
      - last_modified
      - maintainer
      - validation_status
    properties:
      created_date:
        type: string
        format: date
        description: Archetype creation date
      last_modified:
        type: string
        format: date
        description: Last modification date
      maintainer:
        type: string
        description: Archetype maintenance responsible
        examples:
          - protocol-team
          - platform-team
          - security-team
      validation_status:
        type: string
        description: Archetype validation status
        enum:
          - valid
          - pending
          - invalid
          - experimental
        examples:
          - valid
          - experimental
      change_summary:
        type: string
        description: Summary of changes in current version
      deployment_environments:
        type: array
        description: Environments where the archetype can be deployed
        items:
          type: string
          enum:
            - development
            - staging
            - production
            - sandbox
        examples:
          - - development
            - production
      compatibility_matrix:
        type: object
        description: Compatibility matrix with other frameworks
        properties:
          mef_version:
            type: string
            description: Compatible MEF version
          moc_version:
            type: string
            description: Compatible MOC version
          zof_version:
            type: string
            description: Compatible ZOF version
          mal_version:
            type: string
            description: Compatible MAL version
        additionalProperties: false
    additionalProperties: false
additionalProperties: false
allOf:
  - if:
      properties:
        archetype_level:
          const: canonical
    then:
      properties:
        domain_ref:
          const: global
        scope_ref:
          const: all
      required:
        - domain_ref
        - scope_ref
  - if:
      properties:
        archetype_level:
          enum:
            - specialized
            - ephemeral
    then:
      properties:
        domain_ref:
          not:
            const: global
        scope_ref:
          not:
            const: all
      required:
        - domain_ref
        - scope_ref
  - if:
      properties:
        mal_integration:
          properties:
            arbitration_explanation:
              const: true
    then:
      properties:
        mal_integration:
          required:
            - explanation_template_support
            - decision_record_interpretation
