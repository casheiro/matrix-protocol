# MOC Arbitration Policies Schema v1.0.0
# Matrix Ontology Catalog - Arbitration Policies for MAL integration
# Normative canonical specification for arbitration policies configuration

$schema: https://json-schema.org/draft/2020-12/schema
$id: http://localhost:3000/schemas/moc/arbitration-policies/1.0.0
version: 1.0.0
title: MOC Arbitration Policies Schema
description: Canonical schema for MAL arbitration policies in MOC
type: object
required:
  - schema
  - organization_id
  - version
  - arbitration_policies
  - metadata
properties:
  schema:
    type: string
    description: Schema version MOC Arbitration Policies used
    pattern: ^[0-9]+\.[0-9]+$
    examples:
      - "1.0"
      - "1.1"
  organization_id:
    type: string
    description: Unique identifier of the organization
    pattern: ^[a-z0-9-]+$
    examples:
      - techcorp
      - startup-alpha
  version:
    type: string
    description: Version of the arbitration policies configuration
    pattern: ^(0|[1-9]\d*)\.(0|[1-9]\d*)$
    examples:
      - "1.0"
      - "2.1"
  arbitration_policies:
    type: object
    description: Policy configurations for MAL arbitration
    required:
      - default_precedence_order
      - arbitration_timeout
      - conflict_type_policies
    properties:
      default_precedence_order:
        type: array
        description: Default order of precedence rules P1-P6
        minItems: 6
        maxItems: 10
        items:
          type: string
          pattern: ^P[0-9]+_[a-z_]+$
        examples:
          - - P1_authority_weight
            - P2_scope_specificity
            - P3_maturity_level
            - P4_temporal_recency
            - P5_evidence_density
            - P6_deterministic_fallback
      arbitration_timeout:
        type: integer
        description: Timeout for MAL decision in milliseconds
        minimum: 1000
        maximum: 600000
        default: 2000
        examples:
          - 2000
          - 5000
          - 10000
      scope_specificity_rules:
        type: object
        description: Configuration of P2 scope specificity rule
        required:
          - local_instructions
          - mandatory_rules
        properties:
          local_instructions:
            type: object
            description: Precedence for local guidelines
            required:
              - precedence_order
            properties:
              precedence_order:
                type: array
                description: Precedence order by specificity (most specific first)
                items:
                  type: string
                  pattern: ^[a-z0-9-]+$
                examples:
                  - - squad
                    - tribe
                    - organization
              applies_to_types:
                type: array
                description: Knowledge types that follow this rule
                items:
                  type: string
                examples:
                  - - guideline
                    - pattern
                    - best_practice
            additionalProperties: false
          mandatory_rules:
            type: object
            description: Precedence for mandatory rules
            required:
              - precedence_order
            properties:
              precedence_order:
                type: array
                description: Precedence order by authority (highest first)
                items:
                  type: string
                  pattern: ^[a-z0-9-]+$
                examples:
                  - - organization
                    - tribe
                    - squad
              applies_to_types:
                type: array
                description: Knowledge types that follow this rule
                items:
                  type: string
                examples:
                  - - policy
                    - compliance
                    - security_rule
            additionalProperties: false
        additionalProperties: false
      conflict_type_policies:
        type: object
        description: Specific policies by conflict type H1/H2/H3
        required:
          - H1_horizontal_conflicts
          - H2_concurrent_enrichment
          - H3_promotion_contention
        properties:
          H1_horizontal_conflicts:
            type: object
            description: Policies for horizontal conflicts between equivalent UKIs
            required:
              - enable_coexistence
              - require_deprecation
            properties:
              enable_coexistence:
                type: boolean
                description: Allow scope partitioning for coexistence
                default: true
                examples:
                  - true
                  - false
              require_deprecation:
                type: boolean
                description: Force winner-take-all with deprecation of loser
                default: false
                examples:
                  - false
                  - true
              coexistence_strategy:
                type: string
                description: Coexistence strategy when enabled
                enum:
                  - scope_partition
                  - domain_partition
                  - temporal_partition
                default: scope_partition
                examples:
                  - scope_partition
              precedence_order:
                type: array
                description: Specific precedence order for H1
                items:
                  type: string
                  pattern: ^P[0-9]+_[a-z_]+$
                examples:
                  - - P1_authority_weight
                    - P3_maturity_level
                    - P2_scope_specificity
              evidence_weight_multiplier:
                type: number
                description: Weight multiplier for evidence in H1 conflicts
                minimum: 0.1
                maximum: 5
                default: 1
                examples:
                  - 1
                  - 1.5
                  - 2
            additionalProperties: false
          H2_concurrent_enrichment:
            type: object
            description: Policies for concurrent enrichment attempts
            required:
              - temporal_window_ms
              - precedence_order
            properties:
              temporal_window_ms:
                type: integer
                description: Temporal window to consider concurrent enrichment
                minimum: 1000
                maximum: 300000
                default: 30000
                examples:
                  - 30000
                  - 60000
              precedence_order:
                type: array
                description: Specific precedence order for H2
                items:
                  type: string
                  pattern: ^P[0-9]+_[a-z_]+$
                examples:
                  - - P4_temporal_recency
                    - P1_authority_weight
                    - P3_maturity_level
              first_wins_policy:
                type: boolean
                description: First request always wins in case of tie
                default: false
                examples:
                  - false
                  - true
              authority_escalation:
                type: boolean
                description: Escalate to higher authority in case of tie
                default: true
                examples:
                  - true
                  - false
            additionalProperties: false
          H3_promotion_contention:
            type: object
            description: Policies for concurrent promotion proposals
            required:
              - evidence_density_multiplier
              - precedence_order
            properties:
              evidence_density_multiplier:
                type: number
                description: Extra weight for evidence density in promotions
                minimum: 1
                maximum: 10
                default: 1.5
                examples:
                  - 1.5
                  - 2
                  - 3
              precedence_order:
                type: array
                description: Specific precedence order for H3
                items:
                  type: string
                  pattern: ^P[0-9]+_[a-z_]+$
                examples:
                  - - P5_evidence_density
                    - P1_authority_weight
                    - P3_maturity_level
              require_promotion_rationale:
                type: boolean
                description: Requires mandatory rationale for promotion
                default: true
                examples:
                  - true
                  - false
              minimum_evidence_threshold:
                type: integer
                description: Minimum number of evidence for promotion
                minimum: 0
                maximum: 10
                default: 2
                examples:
                  - 2
                  - 3
                  - 5
            additionalProperties: false
        additionalProperties: false
      named_policies:
        type: object
        description: Named arbitration policies for specific contexts
        patternProperties:
          ^[a-z0-9_-]+$:
            type: object
            required:
              - display_name
              - description
              - applicable_contexts
            properties:
              display_name:
                type: string
                description: Display name of the policy
                examples:
                  - Security Policy
                  - Experimental Policy
              description:
                type: string
                description: Description of the policy and when to use
                minLength: 50
                examples:
                  - Specific policy for critical security knowledge
              precedence_order:
                type: array
                description: Customized precedence order
                items:
                  type: string
                  pattern: ^P[0-9]+_[a-z_]+$
                examples:
                  - - P1_authority_weight
                    - P3_maturity_level
                    - P2_scope_specificity
              custom_rules:
                type: array
                description: Additional customized precedence rules
                items:
                  type: object
                  required:
                    - rule_id
                    - description
                    - weight
                  properties:
                    rule_id:
                      type: string
                      pattern: ^P[0-9]+_[a-z_]+$
                      examples:
                        - P7_lifecycle_stage
                        - P8_compliance_level
                    description:
                      type: string
                      examples:
                        - Lifecycle has precedence
                        - Compliance level
                    weight:
                      type: number
                      minimum: 0
                      maximum: 1
                  additionalProperties: false
              applicable_contexts:
                type: object
                description: Contexts where this policy applies
                properties:
                  scopes:
                    type: array
                    items:
                      type: string
                      pattern: ^[a-z0-9-]+$
                  domains:
                    type: array
                    items:
                      type: string
                      pattern: ^[a-z0-9-]+$
                  knowledge_types:
                    type: array
                    items:
                      type: string
                      pattern: ^[a-z0-9_]+$
                  maturity_levels:
                    type: array
                    items:
                      type: string
                      pattern: ^[a-z0-9_]+$
                additionalProperties: false
              overrides:
                type: object
                description: Settings that override defaults
                properties:
                  arbitration_timeout:
                    type: integer
                    minimum: 1000
                    maximum: 600000
                  conflict_type_configs:
                    type: object
                    properties:
                      H1:
                        type: object
                        additionalProperties: true
                      H2:
                        type: object
                        additionalProperties: true
                      H3:
                        type: object
                        additionalProperties: true
                    additionalProperties: false
                additionalProperties: false
            additionalProperties: false
        additionalProperties: false
    additionalProperties: false
  policy_reference_structure:
    type: object
    description: Namespace structure for policy reference
    required:
      - namespace_format
    properties:
      namespace_format:
        type: string
        description: Namespace format for policies
        default: moc:arbitration:{policy_name}
        examples:
          - moc:arbitration:{policy_name}
      reserved_names:
        type: array
        description: Reserved policy names
        items:
          type: string
        examples:
          - - default
            - critical
            - experimental
      policy_inheritance:
        type: object
        description: Policy inheritance configuration
        properties:
          default_fallback:
            type: string
            description: Default fallback policy
            default: default_precedence_order
          policy_override:
            type: string
            description: Named policy completely replaces the default
            const: named policy completely replaces the default
          policy_extension:
            type: string
            description: Named policy modifies specific rules
            const: named policy modifies specific precedence rules
        additionalProperties: false
    additionalProperties: false
  metadata:
    type: object
    description: Metadata of policy configuration
    required:
      - created_date
      - last_modified
      - maintainer
    properties:
      created_date:
        type: string
        format: date
        description: Creation date of configuration
      last_modified:
        type: string
        format: date
        description: Last modification date
      maintainer:
        type: string
        description: Responsible for policy maintenance
        examples:
          - governance-team
          - security-team
      change_summary:
        type: string
        description: Summary of changes in current version
      validation_status:
        type: string
        description: Configuration validation status
        enum:
          - valid
          - pending
          - invalid
      approval_authority:
        type: string
        description: Authority that approved the policies
        examples:
          - cto
          - governance-board
      approval_date:
        type: string
        format: date
        description: Approval date of policies
      testing_results:
        type: object
        description: Policy testing results
        properties:
          last_test_date:
            type: string
            format: date
          test_scenarios:
            type: integer
            description: Number of scenarios tested
            minimum: 0
          success_rate:
            type: number
            description: Test success rate
            minimum: 0
            maximum: 1
        additionalProperties: false
    additionalProperties: false
additionalProperties: false
allOf:
  - properties:
      arbitration_policies:
        properties:
          default_precedence_order:
            contains:
              const: P1_authority_weight
  - properties:
      arbitration_policies:
        properties:
          default_precedence_order:
            contains:
              const: P6_deterministic_fallback
  - properties:
      arbitration_policies:
        properties:
          default_precedence_order:
            additionalItems: false
            items:
              - true
              - true
              - true
              - true
              - true
              - const: P6_deterministic_fallback
